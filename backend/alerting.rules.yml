groups:
  - name: assignment-ai
    rules:
      # High CPU Usage
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High CPU usage detected
          description: CPU usage is above 80% for 5 minutes

      # High Memory Usage
      - alert: HighMemoryUsage
        expr: memory_usage_bytes / memory_total_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High memory usage detected
          description: Memory usage is above 85% for 5 minutes

      # High Disk Usage
      - alert: HighDiskUsage
        expr: disk_usage_bytes / disk_total_bytes * 100 > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High disk usage detected
          description: Disk usage is above 90% for 5 minutes

      # High Error Rate
      - alert: HighErrorRate
        expr: rate(error_total[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: High error rate detected
          description: Error rate is above 5% for 5 minutes

      # Slow Response Time
      - alert: SlowResponseTime
        expr: rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m]) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Slow response time detected
          description: Average response time is above 2 seconds for 5 minutes

      # High Database Query Time
      - alert: SlowDatabaseQueries
        expr: rate(db_query_duration_seconds_sum[5m]) / rate(db_query_duration_seconds_count[5m]) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Slow database queries detected
          description: Average database query time is above 1 second for 5 minutes

      # High AI Service Latency
      - alert: HighAIServiceLatency
        expr: rate(ai_request_duration_seconds_sum[5m]) / rate(ai_request_duration_seconds_count[5m]) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High AI service latency detected
          description: Average AI service request time is above 5 seconds for 5 minutes

      # Low Cache Hit Rate
      - alert: LowCacheHitRate
        expr: rate(cache_hits_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) * 100 < 50
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: Low cache hit rate detected
          description: Cache hit rate is below 50% for 5 minutes

      # Service Down
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: Service is down
          description: Service has been down for more than 1 minute
