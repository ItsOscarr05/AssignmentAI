# AssignmentAI Production Quick Reference

## Environment Files

### Main Production Environment

- **Template**: `env.production.template`
- **Production**: `.env.production` (create from template)
- **Backend**: `backend/.env.production` (create from template)
- **Frontend**: `frontend/.env.production` (create from template)

## Deployment Commands

### Initial Deployment

```bash
# Linux/Mac
./scripts/deploy-production.sh

# Windows PowerShell
.\scripts\deploy-production.ps1
```

### Service Management

```bash
# Start all services
docker-compose -f docker-compose.prod.yml up -d

# Stop all services
docker-compose -f docker-compose.prod.yml down

# View logs
docker-compose -f docker-compose.prod.yml logs -f

# View specific service logs
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend

# Restart specific service
docker-compose -f docker-compose.prod.yml restart backend
```

### Database Operations

```bash
# Run migrations
docker-compose -f docker-compose.prod.yml exec backend alembic upgrade head

# Create backup
docker-compose -f docker-compose.prod.yml exec db pg_dump -U $POSTGRES_USER $POSTGRES_DB > backup_$(date +%Y%m%d_%H%M%S).sql

# Restore backup
docker-compose -f docker-compose.prod.yml exec -T db psql -U $POSTGRES_USER $POSTGRES_DB < backup_file.sql
```

## URLs and Access

### Application URLs

- **Frontend**: https://assignmentai.app
- **API**: https://api.assignmentai.app
- **Monitoring**: https://monitoring.assignmentai.app

### Admin Access

- **Grafana**: https://monitoring.assignmentai.app/grafana
  - Username: `admin`
  - Password: `$GRAFANA_PASSWORD`

## Required Environment Variables

### Critical Variables (Must be set)

```bash
# OpenAI
OPENAI_API_KEY=sk-...

# Stripe
STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=your-stripe-key-here...
STRIPE_WEBHOOK_SECRET=whsec_...

# AWS
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_BUCKET_NAME=assignmentai-prod-files

# OAuth
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...

# Email
SMTP_PASSWORD=...

# SSL
ACME_EMAIL=admin@assignmentai.app
```

### Auto-Generated Variables

```bash
# These are generated by the deployment script
SECRET_KEY=...
POSTGRES_PASSWORD=...
REDIS_PASSWORD=...
GRAFANA_PASSWORD=...
```

## Monitoring and Health Checks

### Service Health

```bash
# Check all services
docker-compose -f docker-compose.prod.yml ps

# Health check endpoints
curl https://api.assignmentai.app/health
curl https://assignmentai.app/health
```

### Monitoring Dashboards

- **Prometheus**: https://monitoring.assignmentai.app
- **Grafana**: https://monitoring.assignmentai.app/grafana

### Key Metrics to Monitor

- CPU and Memory usage
- Database connection pool
- API response times
- Error rates
- Disk space usage
- SSL certificate expiration

## Security Checklist

### Regular Security Tasks

- [ ] Review access logs weekly
- [ ] Check for failed login attempts
- [ ] Monitor for unusual traffic patterns
- [ ] Verify SSL certificate renewal
- [ ] Update dependencies monthly
- [ ] Review user permissions quarterly

### Emergency Security Actions

```bash
# Enable maintenance mode
docker-compose -f docker-compose.prod.yml exec backend python -c "
from app.core.config import settings
settings.ENABLE_MAINTENANCE_MODE = True
"

# Block suspicious IPs
docker-compose -f docker-compose.prod.yml exec traefik traefik --configFile=/etc/traefik/traefik.yml

# Emergency backup
docker-compose -f docker-compose.prod.yml exec db pg_dump -U $POSTGRES_USER $POSTGRES_DB > emergency_backup.sql
```

## Backup and Recovery

### Automated Backups

- Database backups run daily at 2 AM
- Stored in S3 bucket: `assignmentai-prod-backups`
- Retention: 30 days

### Manual Backup

```bash
# Create manual backup
docker-compose -f docker-compose.prod.yml exec db pg_dump -U $POSTGRES_USER $POSTGRES_DB > manual_backup_$(date +%Y%m%d_%H%M%S).sql

# Upload to S3
aws s3 cp manual_backup_*.sql s3://assignmentai-prod-backups/manual/
```

### Recovery Procedures

```bash
# Stop services
docker-compose -f docker-compose.prod.yml down

# Restore database
docker-compose -f docker-compose.prod.yml up -d db
docker-compose -f docker-compose.prod.yml exec -T db psql -U $POSTGRES_USER $POSTGRES_DB < backup_file.sql

# Start services
docker-compose -f docker-compose.prod.yml up -d
```

## Troubleshooting

### Common Issues

#### Service Won't Start

```bash
# Check logs
docker-compose -f docker-compose.prod.yml logs service_name

# Check resource usage
docker stats

# Restart service
docker-compose -f docker-compose.prod.yml restart service_name
```

#### Database Connection Issues

```bash
# Check database status
docker-compose -f docker-compose.prod.yml exec db pg_isready -U $POSTGRES_USER

# Check connection pool
docker-compose -f docker-compose.prod.yml exec backend python -c "
from app.database import engine
print(engine.pool.status())
"
```

#### SSL Certificate Issues

```bash
# Check certificate status
docker-compose -f docker-compose.prod.yml exec traefik traefik version

# Force certificate renewal
docker-compose -f docker-compose.prod.yml restart traefik
```

#### Performance Issues

```bash
# Check resource usage
docker stats

# Check slow queries
docker-compose -f docker-compose.prod.yml exec db psql -U $POSTGRES_USER $POSTGRES_DB -c "
SELECT query, mean_time, calls FROM pg_stat_statements ORDER BY mean_time DESC LIMIT 10;
"
```

## Updates and Maintenance

### Application Updates

```bash
# Pull latest code
git pull origin main

# Rebuild and restart
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml build --no-cache
docker-compose -f docker-compose.prod.yml up -d

# Run migrations
docker-compose -f docker-compose.prod.yml exec backend alembic upgrade head
```

### System Updates

```bash
# Update Docker images
docker-compose -f docker-compose.prod.yml pull

# Update system packages (on host)
sudo apt update && sudo apt upgrade -y

# Restart services
docker-compose -f docker-compose.prod.yml restart
```

## Emergency Contacts

### Technical Support

- **Primary**: [Your Email]
- **Secondary**: [Backup Email]
- **Emergency**: [Phone Number]

### Service Providers

- **Domain Registrar**: [Provider]
- **Hosting Provider**: [Provider]
- **SSL Certificate**: Let's Encrypt (auto-renewal)
- **Monitoring**: Prometheus/Grafana

## Quick Commands Reference

```bash
# View all logs
docker-compose -f docker-compose.prod.yml logs -f

# Check service status
docker-compose -f docker-compose.prod.yml ps

# Access database
docker-compose -f docker-compose.prod.yml exec db psql -U $POSTGRES_USER $POSTGRES_DB

# Access Redis
docker-compose -f docker-compose.prod.yml exec redis redis-cli -a $REDIS_PASSWORD

# View system resources
docker stats

# Check disk usage
df -h

# Check memory usage
free -h

# Monitor network
netstat -tulpn | grep :80
netstat -tulpn | grep :443
```

---

**Remember**: Always test changes in a staging environment before applying to production. Keep backups before making any significant changes.
